# 变量

在最基础的用法上,变量只是给一个信息起了个名字,所以你可以创建一个名为local_ip_v4的变量,而不是182.168.1.1之类的东西,现在只要你需要指定一个ip地址,你就可以使用${local_ip_v4}来引用一个变量，而不需要输入实际的地址.变量的值存储在服务器的内存中,当你检索变量时,FreeSWITCH会从内存中拉出当前值.使用变量由几个好处.

- 管理更改--通过使用变量定义ip地址,你只需要指定一个实际的ip地址,然后在你需要该Ip的地方使用该变量.如果ip地址发生了变化,你只需要更改一个地方就可以了.

- 可读性--通过一个特定的值起一个名字.这样就更容易理解配置,例如.如果你在配置文件中看到一个数字1000,那么这个数字是什么意思就明显了,它是一个扩展名吗?或者是一个超时时间吗?你不知道。你将不得不花费宝贵的时间从周围的本文中获取上下文.通过使用一个有意义的名字的变量,你可以避免这些猜测.
- 数据传递--由于FreeSWITCH是基于模块化架构构建的,所以变量提供了不同模块之间的共享数据的便捷方式.
- 配置--FreeSWITCH核心和许多模块都有预定义的变量作为配置设置,这些变量通常有一个默认值,你可以通过设置变量的值来覆盖.使用这种方式，你可以通过改变其中一个预定义变量的值来控制FreeSWITCH的行为.

#### 全局变量

顾名思义,全局变量对整个FS系统都是可用的,而且所有channels的值都一样.它的目的是用于那些不经常变化的变量.

全局变量可以在配置中使用预处理命令set创建/修改.你也可以使用[global_setvar](https://freeswitch.org/confluence/display/FREESWITCH/mod_commands#mod_commands-global_setvar) api命令来设置.

FreeSWITCH内核和一些模块有许多预定义的变量，其中一些变量在默认配置中的vars.xml中设置，其他的变量有一个由FreeSWITCH内核分配的默认值。有关预定义全局变量的完整列表，请参阅[全局变量](https://freeswitch.org/confluence/display/FREESWITCH/Global+Variables)

### 信道(channel)变量

信道变量是指特定于单个信道的变量,如Caller-Id-Number、Dialed-Number等. 你可以通过设置应用创建一个信道变量.因为信道变量是特定于一个信道的,所以它们只能在信道的上下文中使用,例如在拨号计划中,或者在作为拨号计划的一部分运行的脚本中使用.

### 变量检索

变量可以使用${variable_name}来检索。无论你在哪里使用这个语法,FreeSwitch引擎都会用变量的当前值来替换它.对于全局变量,所有channel的值都是一样的.channel变量值在channel的上下文中可用,并将以当前channel的值为值.例如,在拨号计划中,你可以基于destination_number channel变量创建规则.当拨号计划对一个信道进行评估时,它将检索到这个特定信道的拨号.

你还可以使用[eval](https://freeswitch.org/confluence/display/FREESWITCH/mod_dptools%3A+set)命令检索全局变量的当前值,你可以从[CLI](https://freeswitch.org/confluence/display/FREESWITCH/Command-Line+Interface+fs_cli)中运行该命令.

> 关于变量名前缀是用单$还是双\$\$,有一些混淆.在配置文件中，使用双\$\$语法的文本将预处理程序完全删除,假设有匹配的全局变量，它将使用该值来代替.如果没有匹配的全局变量,它将保持空白. 因为这是由预处理程序完成的，只有配置文件加载到内存时(启动或者重载时)才会被评估。
>
> 单一的$语法不受预处理程序的影响,而是在运行时进行评估,所以如果你在拨号计划中使用它,每次调用时都会重新评估.因此,如果你改变了一个全局变量的值,\$语法将反应新的值.另一个区别是，\$语法可以用来检索全局变量和channel变量,而、而\$\$语法只用于全局变量.
>
> 更加混乱的是 ,这个区别只适用于配置文件。在脚本、cli、api等调用中,\$\$和\$语法没有声明区别,都可以用来检索全局变量和信道变量，而且根据定义,都是在运行时进行评估。

### 系统定义的变量

除了使用set命令创建的变量外，还有数百个变量由FreeSWITCH内核和加载的许多模块创建。[变量管理列表](https://freeswitch.org/confluence/display/FREESWITCH/Variables+Master+List)上有完整的变量列表。